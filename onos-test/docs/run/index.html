<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Run - My Docs</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">My Docs</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Welcome to MkDocs</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Onos config <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../onos-config/">onos-config</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Build</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Golang build</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../onos-config/build/golang-build/">Developer Docker Container</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Protoc go</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../onos-config/build/protoc-go/">Protoc Go Docker Container</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Configs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../onos-config/configs/">Index</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Deployments</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Helm</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Device simulator</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../onos-config/deployments/helm/device-simulator/">Index</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Files</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Configs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../onos-config/deployments/helm/device-simulator/files/configs/">Index</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Onos config</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../onos-config/deployments/helm/onos-config/">Index</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Files</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Certs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../onos-config/deployments/helm/onos-config/files/certs/">Index</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Configs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../onos-config/deployments/helm/onos-config/files/configs/">Index</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Docs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../onos-config/docs/build/">Building onos-config</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/cli/">Administrative and Diagnostic Command-Line</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/community-info/">Contacts and Calendars</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/contributing/">Contributing to onos-config</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/debugging/">Debug onos-config in Onit Using Delve</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/deployment/">Deploying onos-config</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/dev_workflow/">Developer Workflow</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/gnmi/">Northbound gNMI service</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/gnmi_extensions/">gNMI extensions on the Northbound interface</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/license_goland/">GoLand Copyright Profile Setup</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/modelplugin/">Extending onos-config with Model Plugins</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/prerequisites/">Development Prerequisites</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/pull_requests/">Issues and Pull Requests</a>
</li>
            
<li >
    <a href="../../../onos-config/docs/run/">Running onos-config</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Modelplugin</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Yang</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../onos-config/modelplugin/yang/">YANG store</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Onos test <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../">Index</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Docs</a>
    <ul class="dropdown-menu">
            
<li class="active">
    <a href="./">Run</a>
</li>
            
<li >
    <a href="../setup/">How To Install and Run ONIT?</a>
</li>
            
<li >
    <a href="../testing/">Running Tests</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Onos ztp <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../onos-ztp/">onos-ztp</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Repo docs 1 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../repo-docs-1/">repo-docs-1</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Docs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../repo-docs-1/docs/">Index</a>
</li>
            
<li >
    <a href="../../../repo-docs-1/docs/test-1/">Document Test 1</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../../">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../setup/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#how-to-use-onit">How To Use ONIT?</a></li>
        <li class="main "><a href="#cluster-setup">Cluster Setup</a></li>
        <li class="main "><a href="#adding-simulators">Adding Simulators</a></li>
        <li class="main "><a href="#adding-networks">Adding Networks</a></li>
        <li class="main "><a href="#adding-applications">Adding Applications</a></li>
        <li class="main "><a href="#ssh-into-a-cluster-node">SSH Into A Cluster Node</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h2 id="how-to-use-onit">How To Use ONIT?</h2>
<p>The primary interface for setting up test clusters and running tests is the <code>onit</code> command,
which provides a suite of commands for setting up and tearing down test clusters, adding
and removing <a href="https://github.com/onosproject/simulators">device simulators</a>, adding and removing networks of [stratum] switches, adding and removing applications, running tests, and viewing test history. To see list of <code>onit commands</code> run <code>onit</code> from the shell as follows:</p>
<pre><code class="bash">&gt; onit 
Run onos integration tests on Kubernetes

Usage:
  onit [command]

Available Commands:
  add         Add resources to the cluster
  completion  Generated bash or zsh auto-completion script
  create      Create a test resource on Kubernetes
  debug       Open a debugger port to the given resource
  delete      Delete Kubernetes test resources
  fetch       Fetch resources from the cluster
  get         Get test configurations
  help        Help about any command
  onos-cli    Open onos-cli shell for executing commands
  remove      Remove resources from the cluster
  run         Run integration tests
  set         Set test configurations
  ssh         Open a ssh session to a node for executing remote commands

Flags:
  -h, --help   help for onit

Use &quot;onit [command] --help&quot; for more information about a command.
</code></pre>

<h2 id="cluster-setup">Cluster Setup</h2>
<p>The first step to running tests is to setup a test cluster with <code>onit create cluster</code>:</p>
<pre><code class="bash">&gt; onit create cluster
 ✓ Creating cluster namespace
 ✓ Setting up RBAC
 ✓ Setting up Atomix controller
 ✓ Starting Raft partitions
 ✓ Adding secrets
 ✓ Bootstrapping onos-topo cluster
 ✓ Bootstrapping onos-config cluster
 ✓ Setting up GUI
 ✓ Setting up CLI
 ✓ Creating ingress for services
cluster-8face0a8-bed6-11e9-a853-3c15c2cff232
</code></pre>

<p>You can also specify the number of nodes for each onos subsystem, for example, to create a cluster which runs 
two onos-config and two onos-topo pods, run the following command:</p>
<pre><code class="bash">onit create cluster onit-1 --config-nodes 2 --topo-nodes 2
</code></pre>

<p>To setup the cluster, onit creates a unique namespace within which to create test resources,
deploys <a href="https://github.com/atomix/atomix">Atomix</a> inside the test namespace, and configures and deploys onos-config nodes.
Once the cluster is setup, the command will output the name of the test namespace. The namespace
can be used to view test resources via <code>kubectl</code>:</p>
<pre><code class="bash">&gt; kubectl get pods -n cluster-8face0a8-bed6-11e9-a853-3c15c2cff232
NAME                                 READY   STATUS    RESTARTS   AGE
atomix-controller-7f95d69f47-sbsn4   1/1     Running   0          107s
onos-cli-6c6cf7cc89-fmvwq            1/1     Running   0          63s
onos-config-d68456bd7-xf9nv          1/1     Running   0          72s
onos-config-envoy-5c49b74dc4-vpmm4   1/1     Running   0          71s
onos-gui-6c78895d94-lj5vq            1/1     Running   0          65s
onos-topo-654999644-674z5            1/1     Running   0          87s
onos-topo-envoy-dcddf9dc6-2f5q9      1/1     Running   0          87s
raft-1-0                             1/1     Running   0          98s
</code></pre>

<p>The <code>create cluster</code> command supports additional flags for defining the cluster architecture:</p>
<pre><code class="bash">  Flags:
    -c, --config string               test cluster configuration (default &quot;default&quot;)
        --config-nodes int            the number of onos-config nodes to deploy (default 1)
        --docker-registry string      an optional host:port for a private Docker registry
    -h, --help                        help for cluster
        --image-pull-policy string    the Docker image pull policy (default &quot;IfNotPresent&quot;)
        --image-tags stringToString   the image docker container tag for each node in the cluster (default [topo=debug,simulator=latest,stratum=latest,test=latest,atomix=latest,raft=latest,config=debug])
    -s, --partition-size int          the size of each Raft partition (default 1)
    -p, --partitions int              the number of Raft partitions to deploy (default 1)
        --topo-nodes int              the number of onos-topo nodes to deploy (default 1) 
</code></pre>

<p>Once the cluster is setup, the cluster configuration will be added to the <code>onit</code> configuration
and the deployed cluster will be set as the current cluster context:</p>
<pre><code class="bash">&gt; onit get cluster
cluster-b8c45834-a81c-11e9-82f4-3c15c2cff232
</code></pre>

<p>You can also create a cluster by passing a name to the <code>onit create cluster</code> command. To create a cluster with name <code>onit-2</code>, we run the following command:</p>
<pre><code class="bash">&gt; onit create cluster onit-1
onit create cluster onit-1
 ✓ Creating cluster namespace
 ✓ Setting up RBAC
 ✓ Setting up Atomix controller
 ✓ Starting Raft partitions
 ✓ Adding secrets
 ✓ Bootstrapping onos-topo cluster
 ✓ Bootstrapping onos-config cluster
 ✓ Setting up GUI
 ✓ Setting up CLI
 ✓ Creating ingress for services
onit-1
</code></pre>

<p>if we run <code>onit get clusters</code> command, we should be able to see the two clusters that we created:</p>
<pre><code class="bash">&gt; onit get clusters
ID                                             SIZE   PARTITIONS
cluster-b8c45834-a81c-11e9-82f4-3c15c2cff232   1      1
onit-1
</code></pre>

<p>When multiple clusters are deployed, you can switch between clusters by setting the current
cluster context:</p>
<pre><code class="bash">&gt; onit set cluster onit-1
onit-1
</code></pre>

<p>This will run all future cluster operations on the configured cluster. Alternatively, most commands support a flag to override the default cluster.</p>
<p>You can also use <code>set</code> command to redeploy a deployment with a new container image. For example, to redeploy onos-config
subsystem with a new debug image, you can run the following command:</p>
<pre><code class="bash">onit set image onos-config --image onosproject/onos-config:debug
</code></pre>

<p>To delete a cluster, run <code>onit delete cluster</code>:</p>
<pre><code class="bash">&gt; onit delete cluster
✓ Deleting cluster namespace
</code></pre>

<h2 id="adding-simulators">Adding Simulators</h2>
<p>Most tests require devices to be added to the cluster. The <code>onit</code> command supports adding and
removing <a href="https://github.com/onosproject/simulators">device simulators</a> through the <code>add</code> and <code>remove</code> commands. To add a
simulator to the current cluster, simply run <code>onit add simulator</code>:</p>
<pre><code class="bash">&gt; onit add simulator 
✓ Setting up simulator
✓ Reconfiguring onos-config nodes
device-1186885096
</code></pre>

<p>When a simulator is added to the cluster, the cluster is reconfigured in two phases:
* Bootstrap a new <a href="https://github.com/onosproject/simulators">device simulator</a> with the provided configuration
* Reconfigure and redeploy the onos-config cluster with the new device in its stores</p>
<p>To give a name to a simulator, pass a name to <code>onit add simulator</code> command as follows</p>
<pre><code class="bash">&gt; onit add simulator sim-2
✓ Setting up simulator
✓ Reconfiguring onos-config nodes
sim-2
</code></pre>

<p>To get list of simulators, run <code>onit get simulators</code> as follows:</p>
<pre><code class="bash">&gt; onit get simulators 
device-1186885096
sim-2
</code></pre>

<p>Simulators can similarly be removed with the <code>remove simulator</code> command:</p>
<pre><code class="bash">&gt; onit remove simulator device-1186885096
 ✓ Tearing down simulator
 ✓ Reconfiguring onos-config nodes
</code></pre>

<p>As with the <code>add</code> command, removing a simulator requires that the onos-config cluster be reconfigured and redeployed.</p>
<h2 id="adding-networks">Adding Networks</h2>
<p>To run some of the tests on stratum switches, we can create a network of stratum switches using Mininet. To create a network of stratum switches, we can use <code>onit add network [Name] [Mininet Options]</code> as follows: </p>
<ul>
<li>To create a single node network, simply run <code>onit add network</code>. This command creates a single node network and assigns a name to it automatically. </li>
<li>To create a linear network topology with two switches and name it <em>stratum-linear</em>, simply run the following command:</li>
</ul>
<pre><code class="bash">&gt; onit add network stratum-linear -- --topo linear,2
✓ Setting up network
✓ Reconfiguring onos-config nodes
stratum-linear
</code></pre>

<p>When a network is added to the cluster, the cluster is reconfigured in two phases:
* Bootstrap one or more than one new stratum switches with the provided configuration
* Reconfigure and redeploy the onos-config cluster with the new switches in its stores</p>
<p>To add a single node network topology, run the following command:</p>
<pre><code class="bash">&gt; onit add network
✓ Setting up network
✓ Reconfiguring onos-config nodes
network-2878434070
</code></pre>

<p>To get list of networks, run the following command:</p>
<pre><code class="bash">&gt; onit get networks
network-2878434070
stratum-linear
</code></pre>

<p>Networks can be removed using <code>onit remove network</code> command. For example, to remove the linear topolog that is created using the above command, you should run the following command:</p>
<pre><code class="bash">&gt; onit remove network stratum-linear
 ✓ Tearing down network
 ✓ Reconfiguring onos-config nodes
</code></pre>

<p>As with the <code>add</code> command, removing a network requires that the onos-config cluster be reconfigured and redeployed.</p>
<p><strong>Note</strong>: In the current implementation, we support the following network topologies:</p>
<ul>
<li>A <em>Single</em> node network topology</li>
<li>A <em>Linear</em> network topology</li>
</ul>
<h2 id="adding-applications">Adding Applications</h2>
<p>Applications from outside of <code>onit</code> can be added to an <code>onit</code> cluster using the <code>onit add app</code> command. This command takes
the name of the app as an argument. It also has the <code>--image</code> flag that allows a user to specify the image of 
the application that should be  deployed. The user also can specify the pull policy for the image using <code>--image-pull-policy</code> flag. For example, to deploy the latest version of the <code>onos-ztp</code>  application:</p>
<pre><code class="bash">&gt; onit add app onos-ztp --image onosproject/onos-ztp:latest --image-pull-policy &quot;Always&quot; 
 ✓ Setting up app
 onos-ztp
</code></pre>

<p>To give a name to an app, pass a name to the <code>onit add app</code> command as follows</p>
<pre><code class="bash">&gt; onit add app onosproject/onos-ztp:latest ztp
   ✓ Setting up app 
  ztp
</code></pre>

<p>To get list of apps, run <code>onit get apps</code> as follows:</p>
<pre><code class="bash">&gt; onit get apps
  app-128922186
</code></pre>

<p>Apps can be removed with the <code>remove app</code> command:</p>
<pre><code class="bash">&gt; onit remove app app-128922186
   ✓ Tearing down app 
</code></pre>

<h2 id="ssh-into-a-cluster-node">SSH Into A Cluster Node</h2>
<p>onit allows you to ssh into a node using the following command:</p>
<pre><code class="bash">onit ssh &lt;name of a node&gt;
</code></pre>

<p>onit also provides a command that you can run <a href="onos-cli">onos-cli</a> commands via onit as follows:</p>
<pre><code class="bash">onit onos-cli
~ $ onos
ONOS command line client

Usage:
  onos [command]

Available Commands:
  completion  Generated bash or zsh auto-completion script
  help        Help about any command
  topo
  ztp         ONOS zero-touch provisioning subsystem commands

Flags:
  -h, --help   help for onos

Use &quot;onos [command] --help&quot; for more information about a command.
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
